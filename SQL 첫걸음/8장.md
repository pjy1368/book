# 8장. 데이터베이스 설계
## 34강. 데이터베이스 설계
### 1. 데이터베이스 설계
- 데이터베이스를 설계한다는 것은 데이터베이스의 스키마 내에 테이블, 인덱스, 뷰 등의 데이터베이스 객체를 정의하는 것을 말한다.
- 스키마 설계라고도 불린다.

#### 논리명과 물리명
- CREATE TABLE에 지정하는 테이블 이름이나 열 이름을 물리명이라고 부른다.
- 테이블의 '설계상 이름'에 해당하는 것을 논리명이라고 부른다. (실제로 부를 때 사용하는 이름)
- ex) 테이블의 물리명 'item_master', 논리명 '상품 마스터'
- 물리명은 바꾸기가 어렵지만, 논리명은 바꾸기 쉽다.

#### 자료형

#### 고정 길이와 가변 길이
- VARCHAR 형의 용량은 수천 바이트에 불과하므로 LOB 형을 사용해야 한다.

#### 기본키
- 자동 증가 열로 설정하는 방법 -> "AUTO_INCREMENT"
- 단, 자동 증가 열은 PRIMARY KEY 또는 UNIQUE로 유일성을 지정해야 한다.

### 2. ER 다이어그램
- 테이블을 설계할 때 테이블 간의 관계를 명확히 하기 위해 설계도를 작성하는 것.
- E - Entity (개체), R - Relationship (관계) => 개체 간의 관계
- 여기서 R은 관계형 데이터베이스에서의 릴레이션이 아니다.
- 개체는 테이블 또는 뷰를 말한다. ER 다이어그램에서는 사각형으로 표기한다.
- 사각형의 상단에는 개체 이름을 적고 사각형 안에는 개체의 속성을 표기하는데, 속성은 테이블의 열을 의미한다.
- 열 이름은 주로 논리명으로 표기한다.
- 개체와 개체가 서로 연계되는 경우에는 선으로 이어서 표현한다.
- 연계 표기법
  - 일대일, 일대다, 다대다

## 35강. 정규화
- 정규화: 데이터베이스의 테이블을 규정된 올바른 형태로 개선해나가는 것.

### 1. 정규화
- ex) 주문 상품이라는 셀에 "0001 ㅇㅇ 1개, 0002 xx 10개'와 같이 대충 데이터가 들어가 있음.
### 2. 제1 정규형
- ex) 상품코드 0001, 상품명 ㅇㅇ, 개수 1개
- 위와 같이 데이터를 가로(열 방향)가 아닌 세로(행 방향)으로 늘리는 것이 제1 정규화의 1단계이다.
- 제1 정규화에서는 중복을 제거하는 테이블의 분할도 이루어진다.
- 가령, 주문을 하기 위해서 주문자의 인적 사항이 중복될 수 있다.
- 따라서, 주문과 주문 상품 두 개의 테이블로 나눈 뒤 기본키와 외부키를 설정해 준다.
- ex) 주문 테이블의 기본키는 주문번호, 주문 상품 테이블의 외부키는 주문번호

### 3. 제2 정규형
- 데이터가 중복하는 부분을 찾아내서 테이블로 분할한다.
- ex) 주문상품 테이블은 주문 번호, 상품 코드, 상품명, 개수로 이루어짐.
- 위 예시에서 상품명은 상품 코드만 있어도 파악이 가능하고, 개수는 주문 번호와 상품 코드가 있어야 파악이 가능함.
- 따라서, '상품' 테이블을 정의하여 상품코드와 상품명을 묶고, '주문 상품' 테이블은 상품명을 제거한 주문번호, 상품코드, 개수만으로 구성한다.
- 이러한 과정을 부분 함수종속성을 찾아내서 테이블을 분할한다고 부른다.

### 4. 제3 정규형
- 제2 정규화는 기본키에 중복이 없는지 조사하였다.
- 제3 정규화는 기본키 이외의 부분에서 중복이 없는지 검사한다.
- ex) 주문 테이블은 주문번호, 날짜, 성명, 연락처로 이루어짐.
- 위 예시에서 같은 주문자가 주문을 하면, 중복된 데이터가 생긴다.
- 따라서, '주문' 테이블은 주문번호, 날짜, 고객 번호로 구성하고, 성명과 연락처로 구성되어있는 '고객' 테이블을 생성한다.
- 실제로는 제4, 제5 정규형까지 있으나 대부분의 시스템에서 제3 정규형까지만 채택한다.

### 5. 정규화의 목적
- 정규화로 데이터 구조를 개선하는 것은 하나의 데이터가 한 곳에 저장되도록 하기 위함이다.

## 36강. 트랜잭션
### 1. 트랜잭션
#### 발주처리
```mysql
INSERT INTO 주문 VALUES(4, '2014-03-01', 1);
INSERT INTO 주문상품 VALUES(4, '0003', 1);
INSERT INTO 주문상품 VALUES(4, '0004', 2);
```
- 만약, 세 번째 INSERT 명령에서 에러가 발생한다면, 앞서 실행한 두 개의 INSERT 명령을 DELETE 명령으로 삭제하는 번거로운 작업이 필요하다.

### 2. 롤백과 커밋
- 몇 단계로 처리를 나누어 SQL 명령을 실행하는 경우에 트랜잭션을 자주 사용한다.
- 트랜잭션을 롤백하면 변경한 내용이 적용되지 않는다.
- 트랜잭션을 커밋해야 변경 사항을 적용하고 정상적으로 종료가 된다.

#### 자동 커밋
- 자동 커밋을 끄지 않는다면, INSERT나 UPDATE, DELETE가 처리될 떄마다 트랜잭션은 암묵적으로 자동 커밋 상태가 되어 있다.
- 자동 커밋을 끄기 위해서는 명시적으로 트랜잭션의 시작을 선언해야 한다.
```mysql
START TRANSACTION
```
- 변경한 내용을 적용하고 트랜잭션을 종료하고 싶다면, 커밋 명령을 사용한다.
```mysql
COMMIT
```
- 변경한 내용을 적용하지 않고 트랜잭션을 종료하고 싶다면, 롤백 명령을 사용한다.
```mysql
ROLLBACK
```

### 3. 트랜잭션 사용법
- 세트로 실행하고 싶은 SQL 명령은 트랜잭션 내에서 실행한다.
